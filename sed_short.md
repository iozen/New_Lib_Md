
  3. Синтаксис регулярных выражений

   Вы можете использовать такие же регулярные выражения, как и для Bash и популярных языков
   программирования. Вот основные операторы, которые поддерживают регулярные выражения sed
   Linux:

     * - любой символ, любое количество;
     \+ - как звездочка, только один символ или больше;
     \? - нет или один символ;
     \{i\} - любой символ в количестве i;
     \{i,j\} - любой символ в количестве от i до j;
     \{i,\} - любой символ в количестве от i и больше.

  4. Команды sed

   Если вы хотите пользоваться sed, вам нужно знать команды редактирования. Рассмотрим самые
   часто применяемые из них:

     # - комментарий, не выполняется;
     q - завершает работу сценария;
     d - удаляет буфер шаблона и запускает следующую итерацию цикла;
     p - вывести содержимое буфера шаблона;
     n - вывести содержимое буфера шаблона и прочитать в него следующую строку;
     s/что_заменять/на_что_заменять/опции - замена символов, поддерживаются регулярные
     выражения;
     y/символы/символы - позволяет заменить символы из первой части на соответствующие
     символы из второй части;
     w - записать содержимое буфера шаблона в файл;
     N - добавить перевод строки к буферу шаблона;
     D - если буфер шаблона не содержит новую строку, удалить его содержимое и начать новую
     итерацию цикла, иначе удалить содержимое буфера до символа перевода строки и начать
     новую итерацию цикла с тем, что останется;
     g - заменить содержимое буфера шаблона, содержимым дополнительного буфера;
     G - добавить новую строку к содержимому буфера шаблона, затем добавить туда же
     содержимое дополнительного буфера.

   Утилите можно передать несколько команд, для этого их надо разделить точкой с запятой или
   использовать две опции -e. Теперь вы знаете всё необходимое и можно переходить к
   примерам.

Примеры использования sed

   Теперь рассмотрим примеры sed Linux, чтобы у вас сложилась целостная картина об этой
   утилите. Давайте сначала выведем из файла стройки с пятой по десятую. Для этого
   воспользуемся командой -p. Мы используем опцию -n чтобы не выводить содержимое буфера
   шаблона на каждой итерации, а выводим только то, что нам надо. Если команда одна, то
   опцию -e можно опустить и писать без неё:

   sed -n '5,10p' /etc/group


   Или можно вывести весь файл, кроме строк с первой по двадцатую:

   sed '1,20d' /etc/group

   Здесь наоборот, опцию -n не указываем, чтобы выводилось всё, а с помощью команды d
   очищаем ненужное. Дальше рассмотрим замену в sed. Это самая частая функция, которая
   применяется вместе с этой утилитой. Заменим вхождения слова root на losst в том же файле
   и выведем всё в стандартный вывод:

   sed 's/root/losst/g' /etc/group

   Флаг g заменяет все вхождения, также можно использовать флаг i, чтобы сделать регулярное
   выражение sed не зависимым от регистра. Для команд можно задавать адреса. Например,
   давайте выполним замену 0 на 1000, но только в строках с первой по десятую:

   sed '1,10 s/0/1000/g' /etc/group

   Переходим ещё ближе к регулярным выражением, удалим все пустые строки или строи с
   комментариями из конфига Apache:

   sed '/^#\|^$\| *#/d' /etc/apache2/apache2.conf

   Под это регулярное выражение (адрес) подпадают все строки, которые начинаются с #,
   пустые, или начинаются с пробела, а за ним идет решетка. Регулярные выражения можно
   использовать и при замене. Например, заменим все вхождения p в начале строки на losst_p:

   sed 's/[$p*]/losst_p/g' /etc/group

   Если вам надо записать результат замены в обратно в файл можно использовать стандартный
   оператор перенаправления вывода > или утилиту tee. Например:

   sed '/^#\|^$\| *#/d' /etc/apache2/apache2.conf | sudo tee /etc/apache2/apache2.conf

   Также можно использовать опцию -i, тогда утилита не будет выполнять изменения в
   переданном ей файле:

   sudo sed -i '/^#\|^$\| *#/d' /etc/apache2/apache2.conf

   Если надо сохранить оригинальный файл, достаточно передать опции -i в параметре
   расширение для файла резервной копии.


